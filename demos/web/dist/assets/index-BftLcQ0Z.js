(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();class _{x;y;constructor(t=0,e=0){this.x=t,this.y=e}add(t){this.x+=t.x,this.y+=t.y}sub(t){this.x-=t.x,this.y-=t.y}scale(t){this.x*=t,this.y*=t}addmult(t,e){this.x+=e.x*t,this.y+=e.x*t}submult(t,e){this.x-=e.x*t,this.y-=e.x*t}negate(){this.x*=-1,this.y*=-1}}function T(r,t){return new _(r.x+t.x,r.y+t.y)}function Z(r,t){return new _(r.x-t.x,r.y-t.y)}function D(r,t){return new _(r.x*t,r.y*t)}function H(r,t){const e=Math.cos(t),i=Math.sin(t);return new _(r.x*e-r.y*i,r.x*i+r.y*e)}class at{camera;mult;start_world_size;desired_aspect;screen_size;constructor(t,e,i){const s={width:t.canvas.width,height:t.canvas.height},o={w2s:t.canvas.width/i,s2w:i/t.canvas.width},n={pos:new _,zoom:1,viewport:{width:i,height:i/e}};this.camera=n,this.mult=o,this.start_world_size={width:i,height:i/e},this.desired_aspect=e,this.screen_size=s}update(t){window.innerWidth/window.innerHeight>this.desired_aspect?(t.canvas.height=window.innerHeight,t.canvas.width=t.canvas.height*this.desired_aspect):(t.canvas.width=window.innerWidth,t.canvas.height=t.canvas.width/this.desired_aspect),this.screen_size.width=t.canvas.width,this.screen_size.height=t.canvas.height,this.mult.s2w=this.start_world_size.width/this.screen_size.width*this.camera.zoom,this.mult.w2s=this.screen_size.width/this.start_world_size.width/this.camera.zoom}updateViewPort(){const t=new _(this.screen_size.width,this.screen_size.height),e=D(t,this.mult.s2w);this.camera.viewport={width:e.x,height:e.y}}adjustCameraZoom(t,e){const i=this.s2w(e);this.camera.zoom/=t,this.mult.w2s=this.screen_size.width/this.start_world_size.width/this.camera.zoom,this.mult.s2w=this.start_world_size.width/this.screen_size.width*this.camera.zoom;const s=this.s2w(e),o=Z(s,i);this.camera.pos.sub(o),this.updateViewPort()}adjustCameraPos(t){this.camera.pos.sub(t)}w2s(t){const e=this.mult.w2s*(t.x-this.camera.pos.x),i=this.screen_size.height-this.mult.w2s*(t.y-this.camera.pos.y);return new _(e,i)}s2w(t){const e=t.x*this.mult.s2w+this.camera.pos.x,i=(this.screen_size.height-t.y)*this.mult.s2w+this.camera.pos.y;return new _(e,i)}map(t,e,i,s,o){return s+(t-e)*(s-o)/(e-i)}}var F=(r=>(r[r.disc=0]="disc",r[r.rectangle=1]="rectangle",r))(F||{});class N{static ZigTranslation;ptr;zig;constructor(t,e){const i=t.getRigidBodyPtrFromId(e);this.ptr=i,this.zig={id:e,aabb:{pos:new _(t.getRigidBodyAABBPosX(i),t.getRigidBodyAABBPosY(i)),half_width:t.getRigidBodyAABBHalfWidth(i),half_height:t.getRigidBodyAABBHalfHeight(i)},static:t.isRigidBodyStatic(i),num_normals:t.getRigidBodyNumNormals(i),type:t.getRigidBodyType(i),props:{pos:new _(t.getRigidBodyPosX(i),t.getRigidBodyPosY(i)),momentum:new _(t.getRigidBodyMomentumX(i),t.getRigidBodyMomentumY(i)),force:new _(t.getRigidBodyForceX(i),t.getRigidBodyForceY(i)),mass:t.getRigidBodyMass(i),angle:t.getRigidBodyAngle(i),ang_momentum:t.getRigidBodyAngularMomentum(i),torque:t.getRigidBodyTorque(i),inertia:t.getRigidBodyInertia(i),mu:t.getRigidBodyFrictionCoeff(i)},implementation_ptr:t.getRigidBodyImplementation(i)}}getImplementationDiscBody(t){return{radius:t.getDiscBodyRadiusAssumeType(this.zig?.implementation_ptr)}}getImplementationRectangleBody(t){return{width:t.getRectangleBodyWidthAssumeType(this.zig?.implementation_ptr),height:t.getRectangleBodyHeightAssumeType(this.zig?.implementation_ptr)}}getImplementation(t){switch(this.zig?.type){case 0:return this.getImplementationDiscBody(t);case 1:return this.getImplementationRectangleBody(t);default:throw new Error("Undefined type. Could not return implementation")}}}class ct{bbox;action_type;loc;text;text_size;state;constructor(t,e,i,s,o){t.font=a.label.font_size+"px "+a.font,t.textBaseline="middle";const n=t.measureText(o),l=n.width,c=n.fontBoundingBoxAscent+n.fontBoundingBoxDescent;this.bbox={left:s.x,top:s.y,right:s.x+l,bottom:s.y+c},this.text=o,this.action_type=e,this.text_size=a.label.font_size,this.state=0,this.loc=i}render(t){let e=g.string(g.white);this.state==1&&(e=a.widget.hover_bg_color),t.font=this.text_size+"px "+a.font,t.fillStyle=e,t.textBaseline="middle",t.textAlign="center";const i=(this.bbox.left+this.bbox.right)/2,s=(this.bbox.top+this.bbox.bottom)/2;t.fillText(this.text,i,s)}requestAction(t){if(this.action_type==null)return{wants_focus:!1,action:null};const[e,i]=[t.mouse_position.x,t.mouse_position.y];return h.isInside(this.bbox,e,i)&&this.action_type!=null&&(this.state=1),this.state==1?{wants_focus:t.mouse_frame.clicked,action:this.action_type}:{wants_focus:!1,action:null}}}var R=(r=>(r[r.default=0]="default",r[r.hovered=1]="hovered",r[r.clicked=2]="clicked",r[r.down=3]="down",r[r.released=4]="released",r))(R||{});class K{bbox;action_type;loc;text;state;constructor(t,e,i,s,o,n,l){t.font=a.button.font_size+"px "+a.font,t.textBaseline="middle";const c=t.measureText(o),d=c.width+2*a.button.padding,u=n!=null&&n>d?n:d,f=c.fontBoundingBoxAscent+c.fontBoundingBoxDescent+2*a.button.padding,b=l!=null&&l>f?l:f;this.bbox={left:s.x,top:s.y,right:s.x+u,bottom:s.y+b},this.text=o,this.action_type=e,this.state=0,this.loc=i}render(t){let e=a.widget.default_bg_color;this.state==1&&(e=a.widget.hover_bg_color),this.state==2&&(e=a.widget.down_bg_color),this.state==3&&(e=a.widget.down_bg_color),this.state==4&&(e=a.widget.down_bg_color),t.fillStyle=e,t.fillRect(this.bbox.left,this.bbox.top,h.calcWidth(this.bbox),h.calcHeight(this.bbox)),t.font=`normal ${a.button.font_size}px ${a.font}`,t.fillStyle=g.string(g.white),t.textBaseline="middle",t.textAlign="center";const i=(this.bbox.left+this.bbox.right)/2,s=(this.bbox.top+this.bbox.bottom)/2;t.fillText(this.text,i,s)}requestAction(t){if(this.action_type==null)return{wants_focus:!1,action:null};const[e,i]=[t.mouse_position.x,t.mouse_position.y];if(h.isInside(this.bbox,e,i)){const s=JSON.stringify(t.active_widget_loc)==JSON.stringify(this.loc);t.mouse_frame.clicked?(this.state=2,t.active_widget_loc=JSON.parse(JSON.stringify(this.loc))):s&&t.mouse_frame.released?this.state=4:s&&t.mouse_down?this.state=3:this.state=1}return this.state==2||this.state==3?{wants_focus:!0,action:null}:this.state==4?{wants_focus:!1,action:this.action_type}:{wants_focus:!1,action:null}}}class Q{bbox;action_type;loc;text;state;constructor(t,e,i,s,o,n){t.font=a.button.font_size+"px "+a.font,t.textBaseline="middle";const l=t.measureText(o),c=l.width,d=l.fontBoundingBoxAscent+l.fontBoundingBoxDescent;this.bbox={left:s.x,top:s.y,right:s.x+(n||c+2*a.button.padding),bottom:s.y+d+2*a.button.padding},this.text=o,this.action_type=e,this.state=0,this.loc=i}render(t){let e=a.widget.default_bg_color;this.state==1&&(e=a.widget.hover_bg_color),this.state==2&&(e=a.widget.down_bg_color),this.state==3&&(e=a.widget.down_bg_color),this.state==4&&(e=a.widget.down_bg_color),t.fillStyle=e,t.fillRect(this.bbox.left,this.bbox.top,h.calcWidth(this.bbox),h.calcHeight(this.bbox)),t.font="lighter "+a.button.font_size+"px "+a.font,t.fillStyle=g.string(g.white),t.textBaseline="middle",t.textAlign="center";const i=Math.round((this.bbox.left+this.bbox.right)/2)+.5,s=Math.round((this.bbox.top+this.bbox.bottom)/2)+1;t.fillText(this.text,i,s)}requestAction(t){if(this.action_type==null)return{wants_focus:!1,action:null};const[e,i]=[t.mouse_position.x,t.mouse_position.y],s=h.isInside(this.bbox,e,i);return s&&t.mouse_frame.clicked?(this.state=2,t.active_widget_loc=JSON.parse(JSON.stringify(this.loc))):JSON.stringify(t.active_widget_loc)==JSON.stringify(this.loc)&&t.mouse_frame.released?this.state=4:JSON.stringify(t.active_widget_loc)==JSON.stringify(this.loc)&&t.mouse_down?this.state=3:s&&(this.state=1),this.state==2||this.state==3?{wants_focus:!0,action:this.action_type}:this.state==4?{wants_focus:!1,action:null}:{wants_focus:!1,action:null}}}class dt{bbox;action_type;loc;text;text_size;max_width;state;wrapped_lines;constructor(t,e,i,s,o,n){t.font=a.text.font_size+"px "+a.font,t.textBaseline="middle",this.max_width=n,this.text=o,this.action_type=e,this.text_size=a.text.font_size,this.state=0,this.loc=i,this.wrapped_lines=this.wrapText(t,o,n);let l=0;for(let u=0;u<this.wrapped_lines.length;u++){const f=t.measureText(this.wrapped_lines[u]).width;l<f&&(l=f)}const c=this.text_size*a.text.text_height_mult,d=this.wrapped_lines.length*c;this.bbox={left:s.x,top:s.y,right:s.x+l,bottom:s.y+d}}wrapText(t,e,i){const s=e.split(" "),o=[];let n="";for(let l of s){const c=n+(n?" ":"")+l;t.measureText(c).width>i?(n&&o.push(n),n=l):n=c}return n&&o.push(n),o}render(t){let e=g.string(g.white);this.state==1&&(e=a.widget.hover_bg_color),t.font=this.text_size+"px "+a.font,t.fillStyle=e,t.textBaseline="middle",t.textAlign="left";const i=this.text_size*1.2;let s=this.bbox.top+i/2;for(let o of this.wrapped_lines){const n=this.bbox.left;t.fillText(o,n,s),s+=i}}requestAction(t){if(this.action_type==null)return{wants_focus:!1,action:null};const[e,i]=[t.mouse_position.x,t.mouse_position.y];return h.isInside(this.bbox,e,i)&&this.action_type!=null&&(this.state=1),this.state==1?{wants_focus:t.mouse_frame.clicked,action:this.action_type}:{wants_focus:!1,action:null}}}class ht{bbox;action_type;loc;color;constructor(t,e,i,s,o,n){this.color=s,this.bbox={left:i.x,top:i.y,right:i.x+o,bottom:i.y+n},this.action_type=t,this.loc=e}render(t){const e=h.calcWidth(this.bbox),i=h.calcHeight(this.bbox),s=g.toHSVA(this.color),o={h:s.h,s:s.s,v:s.v,a:s.a};o.s=1,o.v=1;const n=g.string(g.fromHSVA(o.h,o.s,o.v,o.a)),l=t.createLinearGradient(this.bbox.left,this.bbox.top,this.bbox.right,this.bbox.top);l.addColorStop(0,"white"),l.addColorStop(1,n),t.fillStyle=l,t.fillRect(this.bbox.left,this.bbox.top,e,i);const c=t.createLinearGradient(this.bbox.left,this.bbox.top,this.bbox.left,this.bbox.bottom);c.addColorStop(0,"rgba(0, 0, 0, 0)"),c.addColorStop(1,"rgba(0, 0, 0, 1)"),t.fillStyle=c,t.fillRect(this.bbox.left,this.bbox.top,e,i);const d=s.s*e+this.bbox.left,u=(1-s.v)*i+this.bbox.top;t.beginPath(),t.arc(d,u,5,0,2*Math.PI),t.fillStyle=g.string(this.color),t.fill(),t.lineWidth=3,t.strokeStyle="black",t.stroke(),t.lineWidth=2,t.strokeStyle="white",t.stroke(),t.closePath()}requestAction(t){if(this.action_type==null)return{wants_focus:!1,action:null};const[e,i]=[t.mouse_position.x,t.mouse_position.y];if(h.isInside(this.bbox,e,i)&&t.mouse_frame.clicked&&(t.active_widget_loc=this.loc),JSON.stringify(t.active_widget_loc)==JSON.stringify(this.loc)&&t.mouse_down){const n=h.calcWidth(this.bbox),l=h.calcHeight(this.bbox),c=x=>Math.min(Math.max(x,.0015),.999),d=c((e-this.bbox.left)/n),u=c(1-(i-this.bbox.top)/l),f=g.toHSVA(this.color);let b;if(u===0)b=g.fromHSVA(f.h,d,0,this.color.a);else if(d===0)b=g.fromHSVA(f.h,0,u,this.color.a);else{const x=g.toHSVA(this.color);b=g.fromHSVA(x.h,d,u,this.color.a)}return this.color=b,t.action_ret_var=this.color,{wants_focus:!0,action:this.action_type}}return{wants_focus:!1,action:null}}}class E{bbox;action_type;loc;widgets;cursor;constructor(t,e,i,s,o,n){this.cursor={x:i+a.layout_commons.padding,y:s},this.bbox={left:i,top:s,right:i+o,bottom:s+n},this.action_type=t,this.loc=e,this.widgets=[]}getInnerWidth(){return h.calcWidth(this.bbox)-2*a.layout_commons.padding}pushWidget(t){this.widgets.push(t)}render(t){for(let e=this.widgets.length-1;e>=0;e--)this.widgets[e].render(t)}requestAction(t){const e=n=>{if(t.active_widget_loc.length===0)return!0;const l=t.active_widget_loc.slice(0,n.loc.length);return l.length===n.loc.length&&l.every((c,d)=>c===n.loc[d])},[i,s]=[t.mouse_position.x,t.mouse_position.y],o=h.isInside(this.bbox,i,s);if(!o&&t.active_widget_loc.length==0)return{iters:null,wants_focus:!1,action:null};if(!t.moving_window)for(let n=0;n<this.widgets.length;n++){const l=this.widgets[n];if(!e(l))continue;const c=l.requestAction(t);if(c.wants_focus||c.action!=null||!(l instanceof E)&&h.isInside(l.bbox,i,s)&&l.action_type!=null&&!(l instanceof C))return{iters:n,wants_focus:c.wants_focus,action:c.action}}return t.active_widget_loc.length>1&&JSON.stringify(t.active_widget_loc)!=JSON.stringify(this.loc)?(t.active_widget_loc=[],{iters:null,wants_focus:!1,action:null}):this.action_type==null?{iters:null,wants_focus:!1,action:null}:(o&&t.mouse_frame.clicked&&(t.moving_window=!0,t.active_widget_loc=this.loc),t.moving_window&&t.mouse_frame.released&&(t.moving_window=!1,t.active_widget_loc=[]),{iters:null,wants_focus:!1,action:null})}makeLabel(t,e,i){const s=new ct(t,e,this.loc.concat([this.widgets.length]),this.cursor,i);return this.pushWidget(s),s}makeButton(t,e,i,s){const o=new K(t,e,this.loc.concat([this.widgets.length]),this.cursor,i,s?.width,s?.height);return this.pushWidget(o),o}makeDraggable(t,e,i,s){const o=new Q(t,e,this.loc.concat([this.widgets.length]),this.cursor,i,s?.width);return this.pushWidget(o),o}makeText(t,e,i,s){const o=new dt(t,e,this.loc.concat([this.widgets.length]),this.cursor,i,s??h.calcWidth(this.bbox)-2*a.layout_commons.padding);return this.pushWidget(o),o}makeColorPickerRect(t,e,i,s){const o=new ht(t,this.loc.concat([this.widgets.length]),this.cursor,e,i,s);return this.pushWidget(o),o}resetCursor(){this.cursor.x=this.bbox.left+2*a.layout_commons.widget_gap,this.cursor.y=this.widgets[this.widgets.length-1].bbox.bottom+a.layout_commons.widget_gap}}class C{bbox;action_type;loc;widgets;title;title_font_size;window_state;constructor(t,e,i,s,o,n){this.action_type=e,this.title=i,this.title_font_size=a.header_commons.font_size,this.bbox={left:s,top:o,right:s+n,bottom:o+1.4*a.header_commons.font_size},this.loc=t,this.widgets=[],this.window_state="open"}render(t){t.fillStyle=this.window_state=="open"?a.header_commons.bg_color:a.window.minimized_header_bg,t.fillRect(this.bbox.left,this.bbox.top,h.calcWidth(this.bbox),h.calcHeight(this.bbox)),t.font=this.title_font_size+"px "+a.font,t.fillStyle=a.header_commons.color,t.textBaseline="middle",t.textAlign="left";const e=this.bbox.left+a.layout_commons.widget_gap,i=(this.bbox.top+this.bbox.bottom)/2;t.fillText(this.title,e,i)}requestAction(t){if(this.action_type==null)return{wants_focus:!1,action:null};const[e,i]=[t.mouse_position.x,t.mouse_position.y];return h.isInside(this.bbox,e,i)&&t.mouse_frame.double_clicked?{wants_focus:!1,action:this.action_type}:{wants_focus:!1,action:null}}}class U extends Q{constructor(t,e,i,s,o){super(t,e,i,s,o)}}class j extends K{constructor(t,e,i,s){super(t,e,i,s,"x")}render(t){let e=a.widget.default_bg_color;this.state==R.hovered&&(e=a.widget.hover_bg_color),this.state==R.clicked&&(e=a.widget.down_bg_color),this.state==R.down&&(e=a.widget.down_bg_color),this.state==R.released&&(e=a.widget.down_bg_color);const i=(this.bbox.left+this.bbox.right)/2;let s=(this.bbox.top+this.bbox.bottom)/2;s+=a.button.font_size*.1,t.fillStyle=e,t.beginPath(),t.arc(i,s,.5*a.button.font_size,0,2*Math.PI),t.fill(),t.closePath(),t.font=`normal ${1.25*a.button.font_size}px ${a.font}`,t.fillStyle=g.string(g.white),t.textBaseline="middle",t.textAlign="center",t.fillText(this.text,i,s)}}class P extends E{min_size;header_height;offset;mode;tools;constructor(t,e,i,s,o,n,l,c,d,u,f,b){super(e,n,l,c,d,u),this.offset=0,this.mode="normal",this.tools={min_width:0,max_width:h.calcWidth(this.bbox)};const x=this.loc.concat([]);x.push(this.widgets.length),s!=null&&this.widgets.push(new U(t,s,x,{x:this.bbox.right-13,y:this.bbox.bottom-20},">"));const p=this.loc.concat([]);p.push(this.widgets.length),o!=null&&this.widgets.push(new j(t,o,p,{x:this.bbox.right-15,y:this.bbox.top-2.5}));const B=n.concat([]);B.push(this.widgets.length);const k=new C(B,i,f,this.cursor.x,this.cursor.y,10);this.widgets.push(k),this.cursor.y+=h.calcHeight(k.bbox)+a.layout_commons.widget_gap,this.header_height=h.calcHeight(k.bbox),this.min_size=b,k.bbox.left=this.bbox.left,k.bbox.right=this.bbox.right}updateBBox(){}setMode(t,e){switch(this.mode=t,this.mode){case"normal":break;case"two columns":this.offset=this.widgets.length,e!=null&&(this.tools.min_width=e.min_width!=null?e.min_width:this.tools.min_width,this.tools.max_width=e.max_width!=null?e.max_width:this.tools.max_width);break}}pushWidget(t){switch(super.pushWidget(t),this.mode){case"normal":this.cursor.y+=h.calcHeight(t.bbox)+a.layout_commons.widget_gap;break;case"two columns":if((this.widgets.length-this.offset)%2==0){this.cursor.x=this.bbox.left+a.layout_commons.padding;const e=this.widgets.length-1,i=Math.max(h.calcHeight(this.widgets[e].bbox),h.calcHeight(this.widgets[e-1].bbox));this.cursor.y+=i+a.layout_commons.widget_gap}else this.cursor.x+=Math.min(this.tools.max_width,Math.max(this.tools.min_width,h.calcWidth(this.bbox)))/2;break}}render(t){t.save();const e=a.layout_commons.border_width;t.beginPath(),t.rect(this.bbox.left,this.bbox.top,h.calcWidth(this.bbox),h.calcHeight(this.bbox)),t.closePath(),t.fillStyle=g.string(a.layout_commons.bg_color),t.fillRect(this.bbox.left,this.bbox.top,h.calcWidth(this.bbox),h.calcHeight(this.bbox)),t.strokeStyle=a.layout_commons.border,t.lineWidth=e,t.strokeRect(this.bbox.left-.5*e,this.bbox.top-.5*e,h.calcWidth(this.bbox)+e,h.calcHeight(this.bbox)+e),t.clip(),super.render(t),t.restore()}requestAction(t){return t.mouse_position.x,{minimise:!1,close:!1,resize:!1,iters:null,wants_focus:!1,action:null}}requestWindowAction(t,e){const i=super.requestAction(e);return i.iters==null?{minimise:!1,close:!1,resize:!1,...i}:this.widgets[i.iters]instanceof C?{minimise:i.action!=null,close:!1,resize:!1,...i}:this.widgets[i.iters]instanceof U&&!t?{minimise:!1,close:!1,resize:i.action!=null,...i}:this.widgets[i.iters]instanceof j?{minimise:!1,close:i.action!=null,resize:!1,...i}:t?{minimise:!1,close:!1,resize:!1,iters:null,wants_focus:!1,action:null}:{minimise:!1,close:!1,resize:!1,...i}}}class mt extends E{columns;constructor(t,e,i,s,o,n){super(t,e,i,s,o,0),this.columns=n}updateBBox(t){const e=a.layout_commons.padding;t.bbox.top<this.bbox.top+e&&(this.bbox.top=t.bbox.top-e),t.bbox.bottom>this.bbox.bottom-e&&(this.bbox.bottom=t.bbox.bottom+e)}pushWidget(t){if(super.pushWidget(t),this.updateBBox(t),this.widgets.length%this.columns==0){let i=Number.NEGATIVE_INFINITY;for(let s=this.widgets.length-this.columns;s<this.widgets.length;s++)this.widgets[s].bbox.bottom>i&&(i=this.widgets[s].bbox.bottom);this.cursor.x=this.bbox.left+a.layout_commons.padding,this.cursor.y=i+a.layout_commons.widget_gap;return}this.cursor.x+=h.calcWidth(this.bbox)/this.columns}render(t){t.fillStyle=g.string(a.layout_commons.bg_color),t.fillRect(this.bbox.left,this.bbox.top,h.calcWidth(this.bbox),h.calcHeight(this.bbox)),t.strokeStyle=a.layout_commons.border,t.lineWidth=1,t.strokeRect(this.bbox.left,this.bbox.top,h.calcWidth(this.bbox),h.calcHeight(this.bbox)),super.render(t)}requestAction(t){const e=i=>{if(t.active_widget_loc.length===0)return!0;const s=t.active_widget_loc.slice(0,i.loc.length);return s.length===i.loc.length&&s.every((o,n)=>o===i.loc[n])};if(!t.moving_window)for(let i=0;i<this.widgets.length;i++){const s=this.widgets[i];if(!e(s))continue;const o=s.requestAction(t);if(o.wants_focus||o.action!=null)return{iters:i,...o}}return{iters:null,wants_focus:!1,action:null}}}class ut{bbox;widgets;constructor(){this.bbox={left:0,right:0,top:0,bottom:0},this.widgets=[]}render(t){t.lineWidth=1}stack_render(t,e){for(let i=e.window_order.length-1;i>=0;i--){const s=e.window_order[i];e.window_active[s]&&this.widgets[s].render(t)}}makeWindow(t,e,i,s){const o=this.widgets.length;e.window_offsets.length<=this.widgets.length&&(e.window_offsets.push({x:0,y:0}),e.window_positions.push({x:s.x??0,y:s.y??0}),e.window_sizes.push({width:s.width??200,height:s.height??200}),e.window_active.push(!0),e.window_minimised.push(!1),e.window_order.unshift(o));const n=new P(t,i.window,i.header,i.resizeable,i.close_btn,[o],e.window_positions[o].x,e.window_positions[o].y,e.window_sizes[o].width,e.window_sizes[o].height,s.title??"Hello, World!",{width:s.min_width??50,height:s.min_height??20});return this.widgets.push(n),n}static makeGrid(t,e,i,s){const o=new mt(e,t.loc.concat([t.widgets.length]),t.cursor.x,t.cursor.y+a.layout_commons.padding,s*(t.bbox.right-t.bbox.left-2*a.layout_commons.padding),i);return t.pushWidget(o),o}endEditing(t){for(let e=0;e<this.widgets.length;e++){const i=this.widgets[e];if(t.window_active[e]&&t.window_minimised[e]&&i instanceof P){i.bbox.bottom=i.bbox.top+i.header_height;for(let s=0;s<=2;s++)if(i.widgets[s]instanceof C){i.widgets[s].window_state="minimised";break}}}}requestAction(t){this.endEditing(t);for(let e=0;e<t.window_order.length;e++){const i=t.window_order[e],s=this.widgets[i];if(t.mouse_frame.released&&(t.resizing_window=!1,document.body.style.cursor="default"),!t.window_active[i])continue;const o=s instanceof P?s.requestWindowAction(t.window_minimised[i],t):s.requestAction(t);o.wants_focus&&(t.window_order.splice(e,1),t.window_order.unshift(i));const n=o;if(s instanceof P&&n.iters!=null){if(n.resize&&(t.resizing_window=!0,document.body.style.cursor="nwse-resize"),t.resizing_window&&JSON.stringify(t.active_widget_loc)==JSON.stringify(s.widgets[n.iters].loc)){t.window_sizes[i].width+=t.window_sizes[i].width<s.min_size.width&&t.mouse_delta_pos.x<0?0:t.mouse_delta_pos.x,t.window_sizes[i].height+=t.window_sizes[i].height<s.min_size.height&&t.mouse_delta_pos.y<0?0:t.mouse_delta_pos.y;break}n.close&&(t.window_active[i]=!1),n.minimise&&(t.window_minimised[i]=!t.window_minimised[i]),t.window_minimised[i]&&(s.bbox.bottom=s.bbox.top+h.calcHeight(s.widgets[n.iters].bbox))}if(document.body.style.cursor="default",t.moving_window&&JSON.stringify(t.active_widget_loc)===JSON.stringify(s.loc)){document.body.style.cursor="grab",t.mouse_frame.clicked?(t.window_order.splice(e,1),t.window_order.unshift(i),t.window_offsets[i].x=s.bbox.left-t.mouse_position.x,t.window_offsets[i].y=s.bbox.top-t.mouse_position.y):t.mouse_down&&(t.window_positions[i].x=t.window_offsets[i].x+t.mouse_position.x,t.window_positions[i].y=t.window_offsets[i].y+t.mouse_position.y);break}if(!(o.action==null&&(!h.isInside(s.bbox,t.mouse_position.x,t.mouse_position.y)||t.moving_window)))return t.mouse_frame.released&&(t.active_widget_loc=[]),o}return{wants_focus:!1,action:null}}}const O=document.createElement("style");O.type="text/css";O.appendChild(document.createTextNode(`
    @font-face {
    font-family: "Hack Regular";
    font-style: normal;
    font-weight: normal;
    src: local("Hack Regular"), url("/hack-webfont/Hack-Regular.woff") format("woff");
    }
    

    @font-face {
    font-family: "Hack Italic";
    font-style: normal;
    font-weight: normal;
    src: local("Hack Italic"), url("/hack-webfont/Hack-Italic.woff") format("woff");
    }
    

    @font-face {
    font-family: "Hack Bold";
    font-style: normal;
    font-weight: normal;
    src: local("Hack Bold"), url("/hack-webfont/Hack-Bold.woff") format("woff");
    }
    

    @font-face {
    font-family: "Hack Bold Italic";
    font-style: normal;
    font-weight: normal;
    src: local("Hack Bold Italic"), url("/hack-webfont/Hack-BoldItalic.woff") format("woff");
    }`));document.head.appendChild(O);const v=document.createElement("canvas");v.id="nvb-imgui-canvas";document.body.appendChild(v);v.style.position="absolute";v.style.top="0px";v.style.left="0px";function wt(){v.width=window.innerWidth,v.height=window.innerHeight,v.style.width=window.innerWidth+"px",v.style.height=window.innerHeight+"px"}function S(r,t){return Math.floor(r*10**t)/10**t}function ft(r,t){let e=r%t;return e<0&&(e+=t),e}function gt(r,t,e,i){i?.min!=null&&i?.max!=null&&console.assert(i.min<i.max);let s=r+e*t.mouse_delta_pos.x;return i?.min!=null&&s<i?.min&&(s=i.min),i?.max!=null&&s>i?.max&&(s=i?.max),s}class g{static white={r:255,g:255,b:255,a:1};static black={r:0,g:0,b:0,a:1};static g_18={r:18,g:19,b:18,a:1};static red={r:255,g:0,b:0,a:1};static default_bg;static EPS_DECIMALS=6;static isColor(t){return typeof t==typeof g.white}static string(t){return`rgba(${t.r}, ${t.g}, ${t.b}, ${t.a})`}static fromString(t){const e=t.match(/rgba?\((\d+),\s*(\d+),\s*(\d+),?\s*(\d*\.?\d+)?\)/);if(!e)throw new Error("Invalid color string format");const[,i,s,o,n]=e;return{r:parseInt(i,10),g:parseInt(s,10),b:parseInt(o,10),a:n!==void 0?parseFloat(n):1}}static fromHex(t){const e=t.replace("#","");if(e.length===6){const i=parseInt(e.slice(0,2),16),s=parseInt(e.slice(2,4),16),o=parseInt(e.slice(4,6),16);return{r:i,g:s,b:o,a:1}}else if(e.length===8){const i=parseInt(e.slice(0,2),16),s=parseInt(e.slice(2,4),16),o=parseInt(e.slice(4,6),16),n=parseInt(e.slice(6,8),16)/255;return{r:i,g:s,b:o,a:n}}else throw new Error("Invalid hex color format")}static toHex(t){const e=Math.round(t.r).toString(16).padStart(2,"0"),i=Math.round(t.g).toString(16).padStart(2,"0"),s=Math.round(t.b).toString(16).padStart(2,"0"),o=Math.round(t.a*255).toString(16).padStart(2,"0");return t.a===1?`#${e}${i}${s}`:`#${e}${i}${s}${o}`}static fromRGB(t){return{...t,a:1}}static fromHSVA(t,e,i,s){const o=ft(t,360),n=i*e,l=n*(1-Math.abs(o/60%2-1)),c=i-n;let[d,u,f]=[0,0,0];return 0<=o&&o<60?[d,u,f]=[n,l,0]:60<=o&&o<120?[d,u,f]=[l,n,0]:120<=o&&o<180?[d,u,f]=[0,n,l]:180<=o&&o<240?[d,u,f]=[0,l,n]:240<=o&&o<300?[d,u,f]=[l,0,n]:300<=o&&o<360&&([d,u,f]=[n,0,l]),[d,u,f]=[255*(d+c),255*(u+c),255*(f+c)],{r:S(d,this.EPS_DECIMALS),g:S(u,this.EPS_DECIMALS),b:S(f,this.EPS_DECIMALS),a:s}}static toHSVA(t){const e=t.r/255,i=t.g/255,s=t.b/255,o=Math.max(e,i,s),n=Math.min(e,i,s),l=o-n;let c=0;l==0?c=0:o===e?c=(60*((i-s)/l)+360)%360:o===i?c=(60*((s-e)/l)+120)%360:o===s&&(c=(60*((e-i)/l)+240)%360);const d=o===0?0:l/o,u=o;return{h:S(c,this.EPS_DECIMALS),s:S(d,this.EPS_DECIMALS),v:S(u,this.EPS_DECIMALS),a:t.a}}}class h{static isInside(t,e,i){return e>t.left&&e<t.right&&i>t.top&&i<t.bottom}static calcWidth(t){return t.right-t.left}static calcHeight(t){return t.bottom-t.top}static set(t,e){t.left=e.left,t.right=e.right,t.top=e.top,t.bottom=e.bottom}}class a{static font="Hack Regular";static widget={default_bg_color:"#666170FF",hover_bg_color:"#9992A8FF",down_bg_color:"#CCC2E0FF"};static label={font_size:12,default_font_color:g.white,inactive_font_color:g.fromHex("#808080FF")};static text={font_size:12,text_height_mult:1.5};static button={padding:3,font_size:12};static layout_commons={padding:10,widget_gap:5,bg_color:g.fromHex("#0F0F0FF0"),border:"#6E6E8080",border_width:1};static header_commons={color:"#ffffff",bg_color:"#4b4654",font_size:12};static window={minimized_header_bg:"#9F9F9F09"};static grid={};static popup={}}class _t{mouse_position;mouse_prev_position;mouse_delta_pos;mouse_down_position;mouse_down;mouse_frame;delta_mouse_scroll={x:0,y:0};moving_window;resizing_window;window_offsets;window_positions;window_sizes;window_active;window_minimised;window_order;active_widget_loc;action_ret_var;last_click_time;double_click_threshold;constructor(t,e,i){this.mouse_position={x:e,y:i},this.mouse_prev_position={x:e,y:i},this.mouse_down_position={x:e,y:i},this.mouse_delta_pos={x:e,y:i},this.mouse_down=!1,this.mouse_frame={clicked:!1,time_at_click:-1,time_since_click:0,double_clicked:!1,released:!1},this.delta_mouse_scroll={x:0,y:0},this.moving_window=!1,this.resizing_window=!1,this.window_offsets=[],this.window_positions=[],this.window_sizes=[],this.window_active=[],this.window_minimised=[],this.window_order=[],this.active_widget_loc=[],this.last_click_time=-1,this.double_click_threshold=300,this.action_ret_var=void 0,t.addEventListener("mousemove",s=>{const o=t.getBoundingClientRect(),n=s.clientX-o.x,l=s.clientY-o.y;this.mouse_position.x=n,this.mouse_position.y=l}),t.addEventListener("mousedown",s=>{const o=t.getBoundingClientRect(),n=s.clientX-o.x,l=s.clientY-o.y;this.mouse_down_position.x=n,this.mouse_down_position.y=l;const c=performance.now();this.mouse_frame.clicked=!0,this.last_click_time!==-1&&c-this.last_click_time<this.double_click_threshold?this.mouse_frame.double_clicked=!0:(this.mouse_frame.double_clicked=!1,c-this.last_click_time>=this.double_click_threshold&&(this.last_click_time=-1)),this.last_click_time=c,this.mouse_down=!0}),t.addEventListener("mouseup",()=>{this.mouse_frame.released=!0,this.mouse_down=!1}),t.addEventListener("wheel",s=>{this.delta_mouse_scroll.x=s.deltaX,this.delta_mouse_scroll.y=s.deltaY})}end(){this.mouse_delta_pos.x=this.mouse_position.x-this.mouse_prev_position.x,this.mouse_delta_pos.y=this.mouse_position.y-this.mouse_prev_position.y,this.mouse_prev_position.x=this.mouse_position.x,this.mouse_prev_position.y=this.mouse_position.y;const t=performance.now();this.mouse_frame.time_at_click!==-1&&(this.mouse_frame.time_since_click=t-this.mouse_frame.time_at_click),this.mouse_frame.clicked&&(this.mouse_frame.time_at_click=t),t-this.last_click_time>=this.double_click_threshold&&(this.mouse_frame.time_at_click=-1,this.mouse_frame.time_since_click=0,this.last_click_time=-1),this.mouse_frame.clicked=!1,this.mouse_frame.released=!1,this.mouse_frame.double_clicked=!1,this.delta_mouse_scroll.x=0,this.delta_mouse_scroll.y=0}}const w=v.getContext("2d"),y=new _t(v,0,0),A={wheel:"wheel.png",red_truck:"red_truck.png"};class bt{units;textures;constructor(t,e,i){this.units=new at(t,e,i),this.textures=new Map}render(t,e){e.clearRect(0,0,e.canvas.width,e.canvas.height),this.units.update(e);var i=new _(y.mouse_position.x,y.mouse_position.y);const s=e.canvas.getBoundingClientRect();i.sub(new _(s.left,s.top));const o=this.units.s2w(i),n=this.units.w2s(o);if(e.beginPath(),e.fillStyle="#1481FF",e.arc(n.x,n.y,5,0,2*Math.PI),e.fill(),e.closePath(),y.delta_mouse_scroll.y!=0&&this.units.adjustCameraZoom(Math.exp(-y.delta_mouse_scroll.y/500),i),y.mouse_down&&!y.moving_window){const b=new _(y.mouse_delta_pos.x,-y.mouse_delta_pos.y),x=D(b,this.units.mult.s2w);this.units.camera.pos.sub(x)}const l=t.solverGetNumBodies();for(let b=0;b<l;b++){const x=t.solverGetBodyIdBasedOnIter(b);if(this.textures.has(x))continue;const p=new N(t,x),B=p.getImplementation(t);if(p.zig==null)continue;const k=p.zig.props.pos,J=this.units.w2s(k);switch(p.zig.type){case F.disc:const st=B;e.fillStyle="#FF9011",p.zig.static&&(e.fillStyle="#fa6c90"),e.beginPath(),e.arc(J.x,J.y,this.units.mult.w2s*st.radius,0,2*Math.PI),e.fill(),e.strokeStyle="#aa4100",p.zig.static&&(e.strokeStyle="#b14d64"),e.lineWidth=.04*this.units.mult.w2s,e.stroke(),e.closePath();break;case F.rectangle:const $=B,I=$.width/2,M=$.height/2;var c=new _(-I,-M),d=new _(I,-M),u=new _(I,M),f=new _(-I,M);const W=p.zig.props.angle;c=H(c,W),d=H(d,W),u=H(u,W),f=H(f,W);const ot=T(c,k),nt=T(d,k),rt=T(u,k),lt=T(f,k),G=this.units.w2s(ot),V=this.units.w2s(nt),Y=this.units.w2s(rt),X=this.units.w2s(lt);e.fillStyle="#90FF11",p.zig.static&&(e.fillStyle="#fa6c90"),e.beginPath(),e.moveTo(G.x,G.y),e.lineTo(V.x,V.y),e.lineTo(Y.x,Y.y),e.lineTo(X.x,X.y),e.closePath(),e.fill(),e.strokeStyle="#406d0e",p.zig.static&&(e.strokeStyle="#b14d64"),e.lineWidth=.04*this.units.mult.w2s,e.stroke();break}}this.textures.forEach((b,x,p)=>{if(b!=null){const B=new N(t,b.id);b.render(e,B)}})}addStandardRigidBodyTex(t,e,i){const s=this,o={image:new Image,scale:i,id:e,render:function(n,l){const c=l.zig;if(c==null)return;const d=c.props.pos,u=s.units.w2s(d),f=s.units.mult.w2s,b=o.image.height/o.image.width,x=f*i,p=f*b*i;n.save(),n.translate(u.x,u.y),n.rotate(-c.props.angle),n.drawImage(o.image,-x/2,-p/2,x,p),n.restore()}};o.image.src=t,this.textures.set(e,o)}}const q={instance:void 0,init(r){this.instance=r.instance}};async function xt(){try{const r=await WebAssembly.instantiateStreaming(fetch("resolve2d.wasm"));if(q.init(r),q.instance==null){console.error("Error: BAD! `wasm.instance` is undefined");return}}catch(r){console.error("Failed to bootstrap WebAssembly module:",r)}}const z=q;setTimeout(()=>{},100);await xt();const m=(()=>{const t=document.getElementById("demo").getContext("2d"),e=new bt(t,16/9,40);if(e.units.camera.pos=new _(-25,-10),z.instance==null){console.error("Error: BAD! `wasm.instance` is undefined");return}return{c:t,renderer:e,simulating:!1,steps:0,process_dt:0,snap_to_body:!0,span_to_body_id:3}})(),tt=60,et=1/tt,L={sub_steps:4,collision_iters:4};function pt(){if(z.instance==null)return;const r=z.instance.exports;r.solverInit(2,4),r.setup_0_2_bridge_stress(),m?.renderer.textures.clear(),m?.renderer.addStandardRigidBodyTex(A.red_truck,3,6),m?.renderer.addStandardRigidBodyTex(A.wheel,4,2.05),m?.renderer.addStandardRigidBodyTex(A.wheel,5,2.05),m?.renderer.textures.set(6,null)}function it(){if(z.instance==null)return;const r=z.instance.exports;r.solverInit(2,4),r.setup_0_1_car_platformer(),m?.renderer.textures.clear(),m?.renderer.addStandardRigidBodyTex(A.red_truck,3,6),m?.renderer.addStandardRigidBodyTex(A.wheel,4,2.05),m?.renderer.addStandardRigidBodyTex(A.wheel,5,2.05),m?.renderer.textures.set(6,null)}window.addEventListener("keydown",r=>{if(z.instance==null)return;const t=z.instance.exports,e=t.getRigidBodyPtrFromId(3),i=t.getRigidBodyPtrFromId(4),s=t.getRigidBodyPtrFromId(5),o=22,n=d=>o-.2*Math.sqrt(Math.abs(d)),l=(d,u=1)=>{t.setRigidBodyAngularMomentum(d,u*n(t.getRigidBodyAngularMomentum(d)/t.getRigidBodyInertia(d)))};r.key=="d"&&(l(i,-1),l(s,-1),t.setRigidBodyTorque(e,500)),r.key=="a"&&(l(i),l(s),t.setRigidBodyTorque(e,-500));const c=30;if(r.key=="ArrowUp"&&t.setRigidBodyMomentumY(e,c),r.key=="ArrowLeft"&&t.setRigidBodyMomentumX(e,-30),r.key=="ArrowDown"&&t.setRigidBodyMomentumY(e,-30),r.key=="ArrowRight"&&t.setRigidBodyMomentumX(e,c),r.key==" "){if(m==null)return;m.simulating=!m?.simulating}});function yt(){const r=1e3/tt,t=performance.now();let e=0,i=!0;function s(){if(!i)return;const n=performance.now(),l=Math.floor((n-t)/r);if(l>=e+1){const c=z.instance?.exports;for(;e<l;){const d=performance.now();m?.simulating&&(c.solverProcess(et,L.sub_steps,L.collision_iters),m&&(m.steps+=1));const u=performance.now();m&&(m.process_dt=u-d),e+=1}}o()}function o(){if(!i)return;const n=t+(e+1)*r,l=Math.max(0,n-performance.now());setTimeout(s,l)}return o(),()=>{i=!1}}function vt(r){const t=()=>{r(),requestAnimationFrame(t)};requestAnimationFrame(t)}it();yt();vt(()=>{if(z.instance==null){console.error("Error: BAD! `wasm.instance` is undefined");return}if(m==null)return;wt();const r=new ut,t=r.makeWindow(w,y,{window:0,header:0,resizeable:0,close_btn:null},{title:"Resolve2D | WASM Demo",x:0,y:20,width:420,height:500});r.makeWindow(w,y,{window:null,header:null,resizeable:null,close_btn:null},{title:"Tip: Double click the window-headers to expand/minimize a window",x:0,y:0,width:470,height:50}),y.window_minimised[1]=!0;const e=z.instance.exports;t.makeLabel(w,null,"Simulation values:"),t.setMode("two columns"),t.makeLabel(w,null,"Simulation compute time: ");const i=Math.floor(10*m.process_dt)/10;t.makeLabel(w,null,i==0?"Not simulating":i+" ms"),t.makeLabel(w,null,"Step: "),t.makeLabel(w,null,""+m.steps),t.makeLabel(w,null,"Num bodies: "),t.makeLabel(w,null,""+e.solverGetNumBodies()),t.makeLabel(w,null,"Mouse world pos: ");var s=new _(y.mouse_position.x,y.mouse_position.y);const o=m.c.canvas.getBoundingClientRect();s.x-=o.left,s.y-=o.top,s=m.renderer.units.s2w(s),s.x=Math.round(s.x*1e3)/1e3,s.y=Math.round(s.y*1e3)/1e3,t.makeLabel(w,null,"("+s.x+", "+s.y+")"),t.setMode("normal");const n=h.calcWidth(t.bbox)/2;t.makeLabel(w,null,""),t.makeLabel(w,null,"Interact with the simulation:"),t.setMode("two columns"),t.makeText(w,null,"Toggle the simulation:",n),t.makeButton(w,1,""+m.simulating),t.makeText(w,null,"Step one time frame forwards: ",n),t.makeButton(w,2,"Step"),t.makeText(w,null,"Process the simulation while holding: ",n),t.makeDraggable(w,2,"Hold");const l=t.makeText(w,null,"Note: The option above will run at the frequency of the UI-update, which will be more frequently than the dedicated physics pipeline. The results of the engine will be the same hover, as the engine is deterministic with the same inputs.");t.setMode("normal"),t.makeLabel(w,null,""),t.cursor.x=l.bbox.left,t.cursor.y=l.bbox.bottom,t.makeLabel(w,null,"Change the rendering options:"),t.setMode("two columns"),t.makeText(w,null,"Focus camera position to a RigidBody: ",n),t.makeButton(w,3,""+m.snap_to_body),t.makeText(w,null,"The index of the focused RigidBody. Hold and drag the button: ",n),t.makeDraggable(w,4,"Index = "+m.span_to_body_id);const c=r.makeWindow(w,y,{window:0,header:0,resizeable:0,close_btn:null},{title:"Press the buttons to test the different scenes!",x:0,y:t.bbox.bottom,width:h.calcWidth(t.bbox),height:100});c.setMode("two columns");const d=h.calcWidth(c.bbox)/2;c.makeText(w,null,"Car-Platformer Scene (default): ",d),c.makeButton(w,5,"Init"),c.makeText(w,null,"Car-Bridge Scene: ",d),c.makeButton(w,6,"Init");const u=r.makeWindow(w,y,{window:0,header:0,resizeable:0,close_btn:null},{title:"List of keybindings",x:0,y:c.bbox.bottom,width:h.calcWidth(t.bbox),height:110});if(u.setMode("two columns"),u.makeLabel(w,null,"Space"),u.makeLabel(w,null,"Toggle the simulation"),u.makeLabel(w,null,"WASD"),u.makeLabel(w,null,"Drive the car"),m.snap_to_body){const x=new N(e,m.span_to_body_id);if(x.zig==null)return;const p=new _(m.renderer.units.camera.viewport.width,m.renderer.units.camera.viewport.height);m.renderer.units.camera.pos=Z(x.zig.props.pos,D(p,.5))}switch(r.requestAction(y).action){case 5:e.solverDeinit(),it(),m.steps=0;break;case 6:e.solverDeinit(),pt(),m.steps=0;break;case 1:m.simulating=!m.simulating;break;case 2:const x=performance.now();e.solverProcess(et,L.sub_steps,L.collision_iters),m.steps+=1,m.process_dt=performance.now()-x;break;case 3:m.snap_to_body=!m.snap_to_body;break;case 4:const p=e.solverGetNumBodies();m.span_to_body_id=Number(gt(Number(m.span_to_body_id),y,2,{min:0,max:p-1}));break}m?.renderer.render(e,m.c),w.clearRect(0,0,v.width,v.height),r.stack_render(w,y),y.end()});
